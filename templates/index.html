<!DOCTYPE html>
<html lang="en">
<link rel="icon" href="https://www.momagic.com/wp-content/uploads/2020/07/200X200-momagic-favicon-final-3.png">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Momagic LED controller</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"
        type="text/javascript"></script>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1145.0.min.js"></script>
    <script src="/static/azure.js"></script>
    <link rel="stylesheet" href="/static/index.css">
    <link rel="stylesheet" href="/static/w3.css">
    </script>
    <style>
        select {
            width: 200px;
            max-width: 100%;
            /* So it doesn't overflow from it's parent */
        }

        option {
            /* wrap text in compatible browsers */
            -moz-white-space: pre-wrap;
            -o-white-space: pre-wrap;
            white-space: pre-wrap;
            /* hide text that can't wrap with an ellipsis */
            overflow: hidden;
            text-overflow: ellipsis;
            /* add border after every option */
            border-bottom: 1px solid #DDD;
        }

        .setting {
            background-color: #296ec6;
            color: rgb(255, 255, 255);
        }
    </style>
</head>

<body>
    <div class="center">
        <div class="whole-width margin-top">
            <h1>Momagic Light Control</h1>
            {% if alert == "nothing" %}
            <div class="alert">
                <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
                <strong>There is no this Device ID. </strong>
            </div>
            {% endif %}
            {% if alert == "something" %}
            <div class="alert">
                <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
                <strong>This Device ID already existed. </strong>
            </div>
            {% endif %}
            <hr />
            <!-- Room -->
            {% for place in places %}
            <div class="margin-top">
                <h2>{{ place['place'] }}- {{ place['device_id'] }}{{ place['status'] }}
                </h2>
                <div class="room">
                    <div class="card-picker">
                        <h3>Choose Color</h3>
                        <br>
                        <div class="color-picker"><input type="color" value="{{ place['color'] }}" id="color_picker"
                                name="{{ place['device_id'] }}" class="color_picker"></div>
                    </div>
                    <div class="card-group">
                        <div class="card">
                            <h3>Color Temperature</h3>
                            <div>
                                <input type="range" min="10" max="100" value="50" id="temp_picker" class="temp_picker"
                                    name="{{ place['device_id'] }}">
                                <b id="temp_display" class="temp_display" name="{{ place['device_id'] }}"> 5000
                                    K</b>
                            </div>
                        </div>
                        <div class="card">
                            <h3>Brightness</h3>
                            <div>
                                <input type="range" min="0" max="100" value="100" id="bright_picker"
                                    class="bright_picker" name="{{ place['device_id'] }}">
                                <b id="bright_display" class="bright_display" name="{{ place['device_id'] }}"> 100
                                </b>
                            </div>
                        </div>
                        <div class="card">
                            <h3 class="light_mode">Quick button: {{ place['mode'] }}</h3>
                            <button id="close" class="close" name="{{ place['device_id'] }}">Close</button>
                            <button id="white" class="white" name="{{ place['device_id'] }}">White</button>
                            <button id="reading" class="reading" name="{{ place['device_id'] }}">Reading</button>
                            <button id="movie" class="movie" name="{{ place['device_id'] }}">Movie</button>
                            <button id="party" class="Party" name="{{ place['device_id'] }}">Party</button>
                            <button id="flower" class="Flower" name="{{ place['device_id'] }}"><img
                                    src="/static/flower.png"></img></button>
                            <button id="india" class="India" name="{{ place['device_id'] }}"><img
                                    src="/static/India.png"></img></button>
                            <button id="taiwan" class="Taiwan" name="{{ place['device_id'] }}"><img
                                    src="/static/Taiwan.png"></img></button>

                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
            <div class="margin-top margin-bottom">
                <button onclick="sche03('')" class="full-button w3-teal w3-ripple ">Schedule</button>
            </div>
            <div id="sche00" class="w3-modal">
                <div class="w3-modal-content w3-card-4 w3-animate-zoom" style="max-width:600px">

                    <div class="w3-container w3-border-top w3-padding-16 w3-light-grey">
                        <div class="w3-center"><br>
                            <span onclick="document.getElementById('sche00').style.display='none'"
                                class="w3-button w3-xlarge w3-transparent w3-display-topright"
                                title="Close Modal">×</span>
                        </div>

                        <form class="w3-container" method="post" onsubmit="schedule(event)">
                            <div class="w3-section">

                                <label class="end"><b>End At (Optional)</b></label>
                                <input class="w3-input w3-border w3-margin-bottom end" type="datetime-local"
                                    name="datetime" id="sdate_end">
                                <label><b>Frequency: </b></label><br>
                                <input type="radio" id="one_time" name="frequency" onclick="sche03('one')"
                                    value="one_time">
                                <label for="one_time">One-Time </label>
                                <input type="radio" id="hour" name="frequency" onclick="sche03('hour00')" value="hour">
                                <label for="hour">Hour </label>
                                <!-- <input type="radio" id="hour" name="frequency" onclick="sche03('hour00')" value="hour">
                                <label for="hour">Hour </label> -->
                                <input type="radio" id="day" name="frequency" onclick="sche03('day00')" value="day">
                                <label for="day">Day </label>
                                <input type="radio" id="week" name="frequency" onclick="sche03('week00')" value="week">
                                <label for="week">Week </label>
                                <input type="radio" id="month" name="frequency" onclick="sche03('month00')"
                                    value="month">
                                <label for="month">Month </label><br>

                                <input class="w3-input w3-border w3-margin-bottom" type="number"
                                    placeholder="At the minute in every hour" name="hour" id="hour00" min="0" max="59">
                                <!-- <input class="w3-input w3-border w3-margin-bottom" type="number"
                                    placeholder="How many hours to repeat" name="hour" id="hour00" min="0" max="23"> -->
                                <input class="w3-input w3-border w3-margin-bottom" type="time"
                                    placeholder="Example- 07:32" name="day" id="day00">
                                <select id="week00" name="week" class="w3-input w3-border w3-margin-bottom">
                                    <option value="Monday">Monday</option>
                                    <option value="Tuseday">Tuesday</option>
                                    <option value="Wednesday">Wednesday</option>
                                    <option value="Thursday">Thursday</option>
                                    <option value="Friday">Friday</option>
                                    <option value="Saturday">Saturday</option>
                                    <option value="Sunday">Sunday</option>
                                </select>

                                <input class="w3-input w3-border w3-margin-bottom" type="number"
                                    placeholder="Day of Month" name="month" id="month00" min="1" max="31">
                                <label class="w3-margin-top"><b>Start From</b></label>
                                <input class="w3-input w3-border w3-margin-bottom" type="datetime-local" name="datetime"
                                    id="sdate" required>
                                <label><b>Device ID</b></label>
                                <select id="sdevice" name="device_id" class="w3-input w3-border w3-margin-bottom"
                                    required>
                                    {% for place in places %}
                                    <option value="{{ place['device_id'] }}">{{ place['device_id'] }}</option>
                                    {% endfor %}
                                </select>
                                <!-- <input class="w3-input w3-border w3-margin-bottom" type="text"
                                    placeholder="Enter Device ID" name="device_id" id="sdevice" required> -->
                                <label><b>Color Picker</b></label>
                                <input type="color" value="#000000" class="w3-input w3-border w3-button"
                                    style="height: 50px; width: 100%" name="color" id="scolor">
                                <button class="w3-button w3-block w3-teal w3-section w3-padding"
                                    id="scheduler">Schedule</button>

                            </div>
                        </form>

                        <div class="w3-container w3-border-top w3-light-grey">
                            <button onclick="reloadP()" type="button"
                                class="w3-button w3-block w3-teal w3-section w3-padding">Job
                                List</button>
                            <button onclick="document.getElementById('sche00').style.display='none'" type="button"
                                class="w3-button w3-red">Cancel</button>

                        </div>


                    </div>
                </div>
            </div>



            <div id="sche01" class="w3-modal">
                <div class="w3-modal-content w3-card-4 w3-animate-zoom" style="max-width:600px">
                    <div class="w3-center"><br>
                        <span onclick="document.getElementById('sche01').style.display='none'"
                            class="w3-button w3-xlarge w3-transparent w3-display-topright" title="Close Modal">×</span>
                    </div>
                    <div class="w3-container">
                        <div class="w3-section">

                            <label for="jobs">Job List:</label><br>
                            <fieldset>

                                {% for job in job_list %}

                                <lable name="job_label">
                                    <input type="checkbox" value="{{ job['record'] }}" name="jobs">
                                    <span style="background-color:{{ job['color'] }};">　　</span>
                                    <span>{{ job['job'] }}</span>
                                    <span>{{ job['at'] }}</span><br>
                                </lable>
                                {% endfor %}
                            </fieldset>
                            <button onclick="sche02()" type="button"
                                class="full-button margin-top margin-bottom w3-teal">Remove Job</button>
                            <button onclick="sche01()" type="button"
                                class="full-button margin-bottom w3-teal">Done</button>

                        </div>
                    </div>
                </div>
            </div>

            <div id="id04" class="w3-modal">
                <div class="w3-modal-content w3-card-4 w3-animate-zoom" style="max-width:600px">
                    <div class="w3-container">
                        <button onclick="document.getElementById('id04').style.display = 'none'" type="button"
                            class="full-button margin-top margin-bottom w3-teal">Schedule
                            Done</button>
                    </div>
                </div>
            </div>
            <div class="margin-bottom">
                <button onclick="document.getElementById('id01').style.display='block'"
                    class="full-button w3-teal w3-ripple ">Add a New Device</button>
            </div>
            <div id="id01" class="w3-modal">
                <div class="w3-modal-content w3-card-4 w3-animate-zoom" style="max-width:600px">

                    <div class="w3-center"><br>
                        <span onclick="document.getElementById('id01').style.display='none'"
                            class="w3-button w3-xlarge w3-transparent w3-display-topright" title="Close Modal">×</span>
                    </div>

                    <form class="w3-container" action="/add" method="post">
                        <div class="w3-section">
                            <label><b>Place Name</b></label>
                            <input class="w3-input w3-border w3-margin-bottom" type="text"
                                placeholder="Enter Place Name" name="place" required>
                            <label><b>Device ID</b></label>
                            <input class="w3-input w3-border" type="text" placeholder="Enter Device ID" name="device_id"
                                required>
                            <button class="w3-button w3-block w3-teal w3-section w3-padding" type="submit">Add a
                                Device</button>

                        </div>
                    </form>

                    <div class="w3-container w3-border-top w3-padding-16 w3-light-grey">
                        <button onclick="document.getElementById('id01').style.display='none'" type="button"
                            class="w3-button w3-red">Cancel</button>

                    </div>

                </div>
            </div>

            <div class="margin-bottom">
                <button onclick="document.getElementById('id02').style.display='block'" class="full-button">Delete a
                    Device</button>
            </div>
            <div id="id02" class="w3-modal">

                <div class="w3-modal-content w3-card-4 w3-animate-zoom" style="max-width:600px">

                    <div class="w3-center"><br>
                        <span onclick="document.getElementById('id02').style.display='none'"
                            class="w3-button w3-xlarge w3-transparent w3-display-topright" title="Close Modal">×</span>
                    </div>

                    <form class="w3-container" action="/delete" method="post">
                        <div class="w3-section">
                            <label><b>Device ID</b></label>
                            <select name="device_id" class="w3-input w3-border w3-margin-bottom" required>
                                {% for place in places %}
                                <option value="{{ place['device_id'] }}">{{ place['device_id'] }}</option>
                                {% endfor %}
                            </select>
                            <!-- <input class="w3-input w3-border" type="text" placeholder="Enter Device ID" name="device_id"
                                required> -->
                            <button class="w3-button w3-block w3-black w3-section w3-padding full-button"
                                type="submit">Delete a
                                Device</button>

                        </div>
                    </form>

                    <div class="w3-container w3-border-top w3-padding-16 w3-light-grey">
                        <button onclick="document.getElementById('id02').style.display='none'" type="button"
                            class="w3-button w3-red">Cancel</button>

                    </div>


                </div>
            </div>
            <div class="margin-bottom">
                <button onclick="document.getElementById('id05').style.display='block'" class="full-button"
                    style="background-color: #296ec6;">☰</button>
            </div>
            <div id="id05" class="w3-modal">
                <div class="w3-modal-content w3-card-4 w3-animate-zoom" style="max-width:600px">
                    <div class="w3-center"><br>
                        <span onclick="document.getElementById('id05').style.display='none'"
                            class="w3-button w3-xlarge w3-transparent w3-display-topright" title="Close Modal">×</span>
                    </div>
                    <div class="w3-container">
                        <div class="w3-section">
                            <label><b>
                                    <h2>Setting</h3>
                                </b></label>

                            <button onclick="window.location.href='{{ reset }}';"
                                class="w3-button w3-block w3-section w3-padding setting">Reset
                                Password</button>

                            <button onclick="window.location.href='{{ profile }}';"
                                class="w3-button w3-block w3-section w3-padding setting">Edit
                                Profile</button>

                            <button onclick="window.location.href='/logout';"
                                class="w3-button w3-block w3-section w3-padding setting">Log
                                Out</button>

                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>


    <!-- <script src="/static/aws.js"></script> -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.17/dist/vue.min.js"></script>
    <script>
        const data = {
            client: {
                endpoint: "{{ endpoint }}",
                connection: null,
                id: 1,
                newMessage: '#000000',
                group: 'Group1',
                chat: { messages: [] },
                connecting: false,
                connected: false,
                groupjoined: false,
                acks: [],
                logs: [],
                userId: null,
                connectionId: null,
                ackId: 0,
            },
        };
    </script>
    <script src="/static/azurepubsub.js"></script>
    <script>
        function getJob() {
            var temp_form = document.createElement("form");
            temp_form.action = "/";
            temp_form.target = "_self";
            temp_form.method = "post";
            temp_form.style.display = "none";
            var opt = document.createElement("textarea");
            opt.name = "list";
            opt.value = 1;
            temp_form.appendChild(opt);
            document.body.appendChild(temp_form);
            temp_form.submit();
        }
        window.onload = function () {
            var reloading = sessionStorage.getItem("reloading");
            if (reloading) {
                sessionStorage.removeItem("reloading");
                document.getElementById('sche01').style.display = 'block';
            }
        }
        function reloadP() {
            sessionStorage.setItem("reloading", "true");
            // document.location.reload();
            getJob()
        }
        function sche01() {
            document.getElementById('sche01').style.display = 'none';
            document.getElementById('sche00').style.display = 'none';

        }
        function sche02() {
            var action_list = document.getElementsByName("jobs");
            var job_label = document.getElementsByName("job_label");
            i = action_list.length;
            while (i--) {
                if (action_list[i].checked) {
                    removeJob(action_list[i].value);
                    job_label[i].remove();
                }
            }
        }
        function sche03(keys) {
            document.getElementById('sche00').style.display = 'block';
            document.getElementById('hour00').style.display = 'none';
            // document.getElementById('hour00').style.display = 'none';
            document.getElementById('day00').style.display = 'none';
            document.getElementById('week00').style.display = 'none';
            document.getElementById('month00').style.display = 'none';
            document.getElementById('sdate').value = ''

            document.getElementById('day00').value = ''
            end = document.getElementsByClassName("end");
            end[0].style.display = "none";
            end[1].style.display = "none";

            if (keys != "" && keys != "one") {
                document.getElementById(keys).style.display = 'block';
                // end[0].style.display = "block";
                // end[1].style.display = "block";
            } else if (keys == "") {
                document.getElementById("sdevice").value = ''
                check = document.querySelector('input[name="frequency"]:checked');
                if (check) {
                    check.checked = false;
                }
            }
        }
    </script>
    <!-- <script src="/static/control.js"></script> -->
</body>

</html>